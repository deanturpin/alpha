#!/bin/bash

cat <<MIME
Content-type:text/plain

MIME

date

IFS=$'\n'
lines=($(cat hosts))

echo ${#lines[*]} lines in host file

for line in ${lines[*]}
do
	# Extract IP
	IP=$(echo $line | cut -d' ' -f1)

	# Ping it and set colour according to status
	[[ $(ping -w 1 -c 1 $IP | grep '1 received') != "" ]] && tput setaf 2 || tput setaf 1

	# Print the line
	echo $line
done

# Reset colours
tput sgr0
